From eeed20578771f8b0daeea5b06df5735f0971f424 Mon Sep 17 00:00:00 2001
From: yarost12 <yaro330@gmail.com>
Date: Wed, 7 Mar 2018 12:20:45 +0530
Subject: [PATCH] drivers: gpu: adreno: compile only Adreno 5xx part

---
 drivers/gpu/msm/Makefile           |   5 --
 drivers/gpu/msm/adreno-gpulist.h   | 119 -----------------------------
 drivers/gpu/msm/adreno.h           |   2 -
 drivers/gpu/msm/adreno_cp_parser.h |  21 +----
 4 files changed, 3 insertions(+), 144 deletions(-)

diff --git a/drivers/gpu/msm/Makefile b/drivers/gpu/msm/Makefile
index 7a1d32737bac..55325ee0157d 100644
--- a/drivers/gpu/msm/Makefile
+++ b/drivers/gpu/msm/Makefile
@@ -27,13 +27,8 @@ msm_adreno-y += \
 	adreno_snapshot.o \
 	adreno_coresight.o \
 	adreno_trace.o \
-	adreno_a3xx.o \
-	adreno_a4xx.o \
 	adreno_a5xx.o \
-	adreno_a3xx_snapshot.o \
-	adreno_a4xx_snapshot.o \
 	adreno_a5xx_snapshot.o \
-	adreno_a4xx_preempt.o \
 	adreno_a5xx_preempt.o \
 	adreno_sysfs.o \
 	adreno.o \
diff --git a/drivers/gpu/msm/adreno-gpulist.h b/drivers/gpu/msm/adreno-gpulist.h
index 778c76f52d0b..0d431ca6a507 100644
--- a/drivers/gpu/msm/adreno-gpulist.h
+++ b/drivers/gpu/msm/adreno-gpulist.h
@@ -14,125 +14,6 @@
 #define ANY_ID (~0)
 
 static const struct adreno_gpu_core adreno_gpulist[] = {
-	{
-		.gpurev = ADRENO_REV_A306,
-		.core = 3,
-		.major = 0,
-		.minor = 6,
-		.patchid = 0x00,
-		.pm4fw_name = "a300_pm4.fw",
-		.pfpfw_name = "a300_pfp.fw",
-		.gpudev = &adreno_a3xx_gpudev,
-		.gmem_size = SZ_128K,
-		.busy_mask = 0x7FFFFFFE,
-	},
-	{
-		.gpurev = ADRENO_REV_A306A,
-		.core = 3,
-		.major = 0,
-		.minor = 6,
-		.patchid = 0x20,
-		.pm4fw_name = "a300_pm4.fw",
-		.pfpfw_name = "a300_pfp.fw",
-		.gpudev = &adreno_a3xx_gpudev,
-		.gmem_size = SZ_128K,
-		.busy_mask = 0x7FFFFFFE,
-	},
-	{
-		.gpurev = ADRENO_REV_A304,
-		.core = 3,
-		.major = 0,
-		.minor = 4,
-		.patchid = 0x00,
-		.pm4fw_name = "a300_pm4.fw",
-		.pfpfw_name = "a300_pfp.fw",
-		.gpudev = &adreno_a3xx_gpudev,
-		.gmem_size = (SZ_64K + SZ_32K),
-		.busy_mask = 0x7FFFFFFE,
-	},
-	{
-		.gpurev = ADRENO_REV_A405,
-		.core = 4,
-		.major = 0,
-		.minor = 5,
-		.patchid = ANY_ID,
-		.features = 0,
-		.pm4fw_name = "a420_pm4.fw",
-		.pfpfw_name = "a420_pfp.fw",
-		.gpudev = &adreno_a4xx_gpudev,
-		.gmem_size = SZ_256K,
-		.busy_mask = 0x7FFFFFFE,
-	},
-	{
-		.gpurev = ADRENO_REV_A420,
-		.core = 4,
-		.major = 2,
-		.minor = 0,
-		.patchid = ANY_ID,
-		.features = ADRENO_USES_OCMEM | ADRENO_WARM_START |
-					ADRENO_USE_BOOTSTRAP,
-		.pm4fw_name = "a420_pm4.fw",
-		.pfpfw_name = "a420_pfp.fw",
-		.gpudev = &adreno_a4xx_gpudev,
-		.gmem_size = (SZ_1M + SZ_512K),
-		.pm4_jt_idx = 0x901,
-		.pm4_jt_addr = 0x300,
-		.pfp_jt_idx = 0x401,
-		.pfp_jt_addr = 0x400,
-		.pm4_bstrp_size = 0x06,
-		.pfp_bstrp_size = 0x28,
-		.pfp_bstrp_ver = 0x4ff083,
-		.busy_mask = 0x7FFFFFFE,
-	},
-	{
-		.gpurev = ADRENO_REV_A430,
-		.core = 4,
-		.major = 3,
-		.minor = 0,
-		.patchid = ANY_ID,
-		.features = ADRENO_USES_OCMEM  | ADRENO_WARM_START |
-			ADRENO_USE_BOOTSTRAP | ADRENO_SPTP_PC | ADRENO_PPD |
-			ADRENO_CONTENT_PROTECTION | ADRENO_PREEMPTION,
-		.pm4fw_name = "a420_pm4.fw",
-		.pfpfw_name = "a420_pfp.fw",
-		.gpudev = &adreno_a4xx_gpudev,
-		.gmem_size = (SZ_1M + SZ_512K),
-		.pm4_jt_idx = 0x901,
-		.pm4_jt_addr = 0x300,
-		.pfp_jt_idx = 0x401,
-		.pfp_jt_addr = 0x400,
-		.pm4_bstrp_size = 0x06,
-		.pfp_bstrp_size = 0x28,
-		.pfp_bstrp_ver = 0x4ff083,
-		.shader_offset = 0x20000,
-		.shader_size = 0x10000,
-		.num_protected_regs = 0x18,
-		.busy_mask = 0x7FFFFFFE,
-	},
-	{
-		.gpurev = ADRENO_REV_A418,
-		.core = 4,
-		.major = 1,
-		.minor = 8,
-		.patchid = ANY_ID,
-		.features = ADRENO_USES_OCMEM  | ADRENO_WARM_START |
-			ADRENO_USE_BOOTSTRAP | ADRENO_SPTP_PC,
-		.pm4fw_name = "a420_pm4.fw",
-		.pfpfw_name = "a420_pfp.fw",
-		.gpudev = &adreno_a4xx_gpudev,
-		.gmem_size = (SZ_512K),
-		.pm4_jt_idx = 0x901,
-		.pm4_jt_addr = 0x300,
-		.pfp_jt_idx = 0x401,
-		.pfp_jt_addr = 0x400,
-		.pm4_bstrp_size = 0x06,
-		.pfp_bstrp_size = 0x28,
-		.pfp_bstrp_ver = 0x4ff083,
-		.shader_offset = 0x20000, /* SP and TP addresses */
-		.shader_size = 0x10000,
-		.num_protected_regs = 0x18,
-		.busy_mask = 0x7FFFFFFE,
-	},
 	{
 		.gpurev = ADRENO_REV_A530,
 		.core = 5,
diff --git a/drivers/gpu/msm/adreno.h b/drivers/gpu/msm/adreno.h
index eaef1aa9c400..0fdae818654f 100644
--- a/drivers/gpu/msm/adreno.h
+++ b/drivers/gpu/msm/adreno.h
@@ -862,8 +862,6 @@ extern unsigned int *adreno_ft_regs;
 extern unsigned int adreno_ft_regs_num;
 extern unsigned int *adreno_ft_regs_val;
 
-extern struct adreno_gpudev adreno_a3xx_gpudev;
-extern struct adreno_gpudev adreno_a4xx_gpudev;
 extern struct adreno_gpudev adreno_a5xx_gpudev;
 
 extern int adreno_wake_nice;
diff --git a/drivers/gpu/msm/adreno_cp_parser.h b/drivers/gpu/msm/adreno_cp_parser.h
index f4d6cd99226e..d6cdfb2ab784 100644
--- a/drivers/gpu/msm/adreno_cp_parser.h
+++ b/drivers/gpu/msm/adreno_cp_parser.h
@@ -15,9 +15,6 @@
 
 #include "adreno.h"
 
-extern const unsigned int a3xx_cp_addr_regs[];
-extern const unsigned int a4xx_cp_addr_regs[];
-
 /*
  * struct adreno_ib_object - Structure containing information about an
  * address range found in an IB
@@ -134,15 +131,7 @@ static inline void adreno_ib_init_ib_obj(uint64_t gpuaddr,
 static inline int adreno_cp_parser_getreg(struct adreno_device *adreno_dev,
 					enum adreno_cp_addr_regs reg_enum)
 {
-	if (reg_enum == ADRENO_CP_ADDR_MAX)
-		return -EEXIST;
-
-	if (adreno_is_a3xx(adreno_dev))
-		return a3xx_cp_addr_regs[reg_enum];
-	else if (adreno_is_a4xx(adreno_dev))
-		return a4xx_cp_addr_regs[reg_enum];
-	else
-		return -EEXIST;
+	return -EEXIST;
 }
 
 /*
@@ -162,12 +151,8 @@ static inline int adreno_cp_parser_regindex(struct adreno_device *adreno_dev,
 {
 	int i;
 	const unsigned int *regs;
-	if (adreno_is_a4xx(adreno_dev))
-		regs = a4xx_cp_addr_regs;
-	else if (adreno_is_a3xx(adreno_dev))
-		regs = a3xx_cp_addr_regs;
-	else
-		return -EEXIST;
+
+	return -EEXIST;
 
 	for (i = start; i <= end && i < ADRENO_CP_ADDR_MAX; i++)
 		if (regs[i] == offset)

